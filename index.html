<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>合约连通性测试</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .btn { padding: 10px 20px; background: #0066ff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .status { margin-top: 15px; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>合约连通性测试（BSC主网）</h1>
    <p>合约地址：<input id="contract-address" value="0xCb5c82879A56006d6eEF2d03391E48ff774919A2" style="width: 500px;"></p>
    <button id="test-btn" class="btn">测试合约连通性</button>
    <div id="status" class="status"></div>

    <script>
        const CONTRACT_ADDRESS = document.getElementById('contract-address').value;
        const TEST_ABI = [
            { "inputs": [], "name": "paused", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "view", "type": "function" }
        ];

        document.getElementById('test-btn').addEventListener('click', async () => {
            const statusEl = document.getElementById('status');
            statusEl.textContent = '测试中...';
            statusEl.className = 'status';

            try {
                if (!window.ethereum) throw new Error('未检测到MetaMask');
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                // 编码paused函数调用
                const funcStr = 'paused()';
                const encoder = new TextEncoder();
                const hash = await crypto.subtle.digest('SHA-256', encoder.encode(funcStr));
                const sigHash = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('').substring(0, 8);
                const data = `0x${sigHash}`;

                // 调用合约
                const result = await window.ethereum.request({
                    method: 'eth_call',
                    params: [{ to: CONTRACT_ADDRESS, data: data }, 'latest']
                });

                statusEl.textContent = `测试成功！合约暂停状态：${result === '0x0000000000000000000000000000000000000000000000000000000000000001' ? '是' : '否'}`;
                statusEl.className = 'status success';
            } catch (error) {
                statusEl.textContent = `测试失败：${error.message}（错误码：${error.code || '无'}）`;
                statusEl.className = 'status error';
                console.error('测试失败详情:', error);
            }
        });
    </script>
</body>
</html>
