<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¨æŠ¼ & åˆ†çº¢ (BSC)</title>
    <!-- å†…è” Ethers åº“ï¼Œæ— å¤–éƒ¨ä¾èµ– -->
    <script>
        !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ethers=t()}(this,(function(){"use strict";const e=new TextEncoder,t=new TextDecoder,n="function"==typeof BigInt?BigInt:void 0;function r(e){return e.replace(/^0x/i,"")}function o(e){return"0x"+e}function i(e){return e.startsWith("0x")&&e.length%2===0}function a(e){if(!i(e))throw new Error(`invalid hex string: ${e}`);return t.decode(Uint8Array.from(r(e).match(/.{2}/g).map((e=>parseInt(e,16)))))}function s(e){return o(Array.from(e).map((e=>e.toString(16).padStart(2,"0"))).join(""))}function u(e){return Uint8Array.from(r(e).match(/.{2}/g).map((e=>parseInt(e,16))))}function c(e){return e.reduce(((e,t)=>e*256+t),0)}function f(e){const t=[];do{t.unshift(e%256),e=Math.floor(e/256)}while(e>0);return Uint8Array.from(t)}function d(e,t){const n=new Uint8Array(t);return e.length<=t?(n.set(e,0),n):n.set(e.slice(e.length-t),0),n}function l(e){return e.length===0?0:c(e)}function p(e){if("string"==typeof e)return e.startsWith("0x")?n(e):n(parseInt(e,10));if("number"==typeof e)return n(e);if(e instanceof Uint8Array)return n(o(e));throw new Error(`cannot convert to BigInt: ${e}`)}function g(e){return e.toString(16)}function h(e){return o(g(e))}function b(e){return e?`0x${e.toString(16).padStart(64,"0")}`:"0x0000000000000000000000000000000000000000000000000000000000000000"}function v(e){return e.slice(0,32)}function m(e){return e.slice(32)}function y(e){return e.length>32?h(p(e)):b(p(e))}function w(e){return e.map((e=>y(e))).join("")}function x(e){const t=[];let n=0;for(;n<<e.length;n+=64)t.push(e.slice(n,n+64));return t.map((e=>u(e)))}function k(e){return x(w(e))}function A(e){return e.map((e=>a(e))).join("")}function T(e){return e.split("").map((e=>s(e)))}function E(e){return A(k(T(e)))}function S(e){return new Promise(((t,n)=>{if("function"==typeof window.ethereum){const r=window.ethereum;r.on("accountsChanged",(e=>t(e[0]))),r.on("chainChanged",((e)=>{})),r.request({method:"eth_requestAccounts"}).then((e=>t(e[0]))).catch(n)}else n(new Error("MetaMask not found"))}))}class I{constructor(e){this.provider=e,this.signer=null}async connect(){const e=await S();this.signer=e;return e}async send(e,t=[]){return this.provider.request({method:e,params:t})}async getSigner(){return this.signer||(await this.connect()),this.signer}}class O{constructor(e,t){this.address=e,this.abi=t,this.provider=null,this.signer=null}connect(e){this.provider=e,this.signer=e.signer;return this}async call(e,t=[]){const n=this.abi.find((t=>t.name===e));if(!n)throw new Error(`function ${e} not found`);const r=this.encodeFunctionCall(n,t);return this.provider.send("eth_call",[{to:this.address,data:r},"latest"])}async sendTransaction(e,t=[]){const n=this.abi.find((t=>t.name===e));if(!n)throw new Error(`function ${e} not found`);const r=this.encodeFunctionCall(n,t);return this.provider.send("eth_sendTransaction",[{to:this.address,data:r,from:this.signer}])}encodeFunctionCall(e,t){const n=e.inputs.map((e=>e.type)),r=this.encodeFunctionSignature(e),o=this.encodeParameters(n,t);return r+o.slice(2)}encodeFunctionSignature(e){const t=`${e.name}(${e.inputs.map((e=>e.type)).join(",")})`;return this.keccak256(s(t)).slice(0,10)}encodeParameters(e,t){let n="";for(let r=0;r<<e.length;r++){const o=e[r],i=t[r];n+=this.encodeParameter(o,i)}return n}encodeParameter(e,t){switch(e){case"address":return this.encodeAddress(t);case"uint256":case"uint8":return this.encodeUint(t);case"bool":return this.encodeBool(t);default:throw new Error(`unsupported type: ${e}`)}}encodeAddress(e){return e.startsWith("0x")?e.padEnd(66,"0"):o(e).padEnd(66,"0")}encodeUint(e){return b(p(e))}encodeBool(e){return e?"0x0000000000000000000000000000000000000000000000000000000000000001":"0x0000000000000000000000000000000000000000000000000000000000000000"}decodeParameters(e,t){const n=[];let r=0;for(let o=0;o<<e.length;o++){const i=e[o],a=i.type,s=t.slice(2),u=s.slice(r,r+64);r+=64;n.push(this.decodeParameter(a,o(u)))}return n}decodeParameter(e,t){switch(e){case"address":return t.slice(26);case"uint256":case"uint8":return p(t);case"bool":return"0x0000000000000000000000000000000000000000000000000000000000000001"===t;default:throw new Error(`unsupported type: ${e}`)}}keccak256(e){const t=new Uint32Array(8),n=new Uint8Array(64);let r,o,i,a,s,u,c,f,d,l,p,g,h,b,v,m,y;for(let w=0;w<8;w++)t[w]=0x6a09e667f3bcc908,0xbb67ae8584caa73b,0x3c6ef372fe94f82b,0xa54ff53a5f1d36f1,0x510e527fade682d1,0x9b05688c2b3e6c1f,0x1f83d9abfb41bd6b,0x5be0cd19137e2179[w];const x=e.length,k=e.length*8;let A=k;for(r=0;r<x;r+=64){const e=Math.min(64,x-r);n.set(e.subarray(r,r+e),0);if(r+64<=x)t=this._compress(n,t);else{for(o=r;o<r+64&&o<x;o++)n[o-r]=e[o];n[o-r]=128;if(64-8<=o-r){this._compress(n,t);for(i=0;i<64;i++)n[i]=0}for(a=63;a>=64-8;a--)n[a]=k>>8*(63-a)&255;this._compress(n,t)}}const T=new Uint8Array(32);for(s=0;s<8;s++)for(u=0;u<4;u++)T[s*4+u]=(t[s]>>8*(3-u))&255;return o(T)}_compress(e,t){const n=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];let r,o,i,a,s,u,c,f,d,l,p,g=t[0],h=t[1],b=t[2],v=t[3],m=t[4],y=t[5],w=t[6],x=t[7];for(r=0;r<16;r++){const t=r*4,n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];n[r]=t}for(r=16;r<64;r++){i=n[r-15],a=this._rotr(i,7)^this._rotr(i,18)^i>>>3,s=n[r-2],u=this._rotr(s,17)^this._rotr(s,19)^s>>>10,n[r]=(n[r-16]+i+a+n[r-7]+s+u)&4294967295}for(r=0;r<64;r++)c=this._rotr(g,28)^this._rotr(g,34)^this._rotr(g,39),f=(g&h)^(~g&b),d=f+v+c+n[r],l=this._rotr(m,14)^this._rotr(m,18)^this._rotr(m,41),p=(m&y)^(m&w)^(y&w),v=b,b=h,h=g,g=d+l&4294967295,w=y,y=m,m=d&4294967295}return t[0]=(t[0]+g)&4294967295,t[1]=(t[1]+h)&4294967295,t[2]=(t[2]+b)&4294967295,t[3]=(t[3]+v)&4294967295,t[4]=(t[4]+m)&4294967295,t[5]=(t[5]+y)&4294967295,t[6]=(t[6]+w)&4294967295,t[7]=(t[7]+x)&4294967295,t}_rotr(e,t){return e>>>t|e<<32-t}}window.ethers={BrowserProvider:function(e){return new I(e)},Contract:function(e,t,n){return new O(e,t).connect(n)},utils:{parseEther:function(e){return p((parseFloat(e)*1e18).toString())},formatEther:function(e){return(p(e)/n(1e18)).toString()}}}}));
    </script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text x=%220%22 y=%2290%22 font-size=%2290%22>ğŸ¤‘</text></svg>" type="image/svg+xml">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #1a1a2e;
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
        }

        .connect-btn {
            background-color: #0066ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .connect-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .connect-btn:hover:not(:disabled) {
            background-color: #0052cc;
        }

        .section {
            background-color: #16213e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #e0e0e0;
        }

        .info-line {
            margin-bottom: 10px;
            color: #b0b0b0;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #6441a5;
            color: white;
        }

        .btn-primary:hover {
            background-color: #533894;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-outline {
            background-color: transparent;
            color: #b0b0b0;
            border: 1px solid #333;
        }

        .btn-outline:hover {
            background-color: #2d3436;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #b0b0b0;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            background-color: #0f3460;
            border: 1px solid #333;
            border-radius: 5px;
            color: white;
            font-size: 16px;
        }

        .input-group input::placeholder {
            color: #666;
        }

        .stake-item {
            background-color: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .stake-item .stake-info {
            font-size: 14px;
            margin-bottom: 5px;
            color: #b0b0b0;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
        }

        .status.success {
            background-color: #27ae60;
            color: white;
        }

        .status.error {
            background-color: #c0392b;
            color: white;
        }

        .status.info {
            background-color: #3498db;
            color: white;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">è´¨æŠ¼ & åˆ†çº¢ (BSC)</div>
            <button id="connect-btn" class="connect-btn">è¿æ¥ MetaMask</button>
        </header>

        <div id="app-content" class="hidden">
            <div class="section">
                <div class="info-line">å¯é¢†å–åˆ†çº¢: <span id="pending-rewards">-</span> BNB</div>
            </div>

            <div class="section">
                <div class="section-title">æˆ‘çš„è´¨æŠ¼æ¡ç›®</div>
                <button id="refresh-stakes" class="btn btn-outline">åˆ·æ–°è´¨æŠ¼åˆ—è¡¨</button>
                <div id="stakes-list" style="margin-top: 15px;">
                    <div style="text-align: center; color: #666;">æš‚æ— è´¨æŠ¼è®°å½•</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">æ“ä½œ</div>

                <div style="margin-bottom: 20px;">
                    <div class="section-title" style="font-size: 16px; margin-bottom: 10px;">é¢†å–åˆ†çº¢</div>
                    <button id="claim-rewards" class="btn btn-primary">é¢†å–åˆ†çº¢</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div class="section-title" style="font-size: 16px; margin-bottom: 10px;">è´¨æŠ¼ä»£å¸</div>
                    <div class="input-group">
                        <input type="text" id="stake-amount" placeholder="è¾“å…¥è´¨æŠ¼æ•°é‡">
                    </div>
                    <button id="approve-token" class="btn btn-outline">å…ˆæ‰¹å‡†ï¼ˆERC20 æˆæƒï¼‰</button>
                    <button id="stake-token" class="btn btn-primary">è´¨æŠ¼</button>
                </div>

                <div>
                    <div class="section-title" style="font-size: 16px; margin-bottom: 10px;">å–æ¶ˆè´¨æŠ¼ï¼ˆæŒ‰ç´¢å¼•ï¼‰</div>
                    <div class="input-group">
                        <input type="number" id="unstake-index" placeholder="è¾“å…¥è¦è§£é™¤çš„è´¨æŠ¼ç´¢å¼•ï¼ˆæ•´æ•°ï¼‰" min="0">
                    </div>
                    <button id="unstake-token" class="btn btn-danger">å–æ¶ˆè´¨æŠ¼ï¼ˆæŒ‰ç´¢å¼•ï¼‰</button>
                </div>
            </div>

            <div id="status" class="status" style="display: none;"></div>
        </div>

        <div id="welcome-content">
            <div class="section" style="text-align: center; padding: 40px 20px;">
                <div class="section-title" style="font-size: 24px; margin-bottom: 20px;">æ¬¢è¿ä½¿ç”¨è´¨æŠ¼ & åˆ†çº¢ DApp</div>
                <p style="margin-bottom: 30px; color: #b0b0b0;">è¯·è¿æ¥æ‚¨çš„ MetaMask é’±åŒ…ä»¥å¼€å§‹ä½¿ç”¨</p>
                <button id="welcome-connect-btn" class="btn btn-primary">è¿æ¥ MetaMask</button>
            </div>
        </div>
    </div>

    <script>
        // åˆçº¦é…ç½®
        const CONTRACT_ADDRESS = '0xCb5c82879A56006d6eEF2d03391E48ff774919A2';
        const CONTRACT_ABI = [{"inputs":[{"internalType":"address","name":"_memeToken","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"EnforcedPause","type":"error"},{"inputs":[],"name":"ExpectedPause","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"DividendDistributed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"admin","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"EmergencyWithdrawBNB","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"admin","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"EmergencyWithdrawMEME","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newBlocks","type":"uint256"}],"name":"LockBlocksUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"oldToken","type":"address"},{"indexed":false,"internalType":"address","name":"newToken","type":"address"}],"name":"MemeTokenUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newAmount","type":"uint256"}],"name":"MinLockAmountUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RewardClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Staked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"penalty","type":"uint256"}],"name":"Unstaked","type":"event"},{"inputs":[],"name":"BURN_ADDRESS","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DISTRIBUTION_THRESHOLD","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PENALTY_RATE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"disableStaking","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"dividendPerToken","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"emergencyWithdrawBNB","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"emergencyWithdrawMEME","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"enableStaking","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getPendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getUserStake","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"startBlock","type":"uint256"},{"internalType":"uint256","name":"unlockBlock","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserStakeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lockBlocks","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"memeToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minLockAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pendingBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_blocks","type":"uint256"}],"name":"setLockBlocks","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newMemeToken","type":"address"}],"name":"setMemeToken","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"setMinLockAmount","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"stake","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"unstake","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userStakes","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"startBlock","type":"uint256"},{"internalType":"uint256","name":"dividendPerTokenAtStake","type":"uint256"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];

        let provider;
        let signer;
        let contract;
        let memeTokenContract;
        let currentAccount;

        // DOM å…ƒç´ 
        const connectBtn = document.getElementById('connect-btn');
        const welcomeConnectBtn = document.getElementById('welcome-connect-btn');
        const appContent = document.getElementById('app-content');
        const welcomeContent = document.getElementById('welcome-content');
        const pendingRewardsEl = document.getElementById('pending-rewards');
        const refreshStakesBtn = document.getElementById('refresh-stakes');
        const stakesListEl = document.getElementById('stakes-list');
        const claimRewardsBtn = document.getElementById('claim-rewards');
        const stakeAmountInput = document.getElementById('stake-amount');
        const approveTokenBtn = document.getElementById('approve-token');
        const stakeTokenBtn = document.getElementById('stake-token');
        const unstakeIndexInput = document.getElementById('unstake-index');
        const unstakeTokenBtn = document.getElementById('unstake-token');
        const statusEl = document.getElementById('status');

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–äº‹ä»¶ç»‘å®š...');
            
            // æ£€æŸ¥ ethers åº“æ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof ethers === 'undefined') {
                console.error('ethers åº“æœªåŠ è½½æˆåŠŸï¼');
                showStatus('é”™è¯¯ï¼šethers åº“æœªåŠ è½½æˆåŠŸï¼Œè¯·åˆ·æ–°é¡µé¢', 'error');
                return;
            }
            console.log('ethers åº“åŠ è½½æˆåŠŸ');
            
            // ç»‘å®šäº‹ä»¶
            connectBtn.addEventListener('click', connectMetaMask);
            welcomeConnectBtn.addEventListener('click', connectMetaMask);
            refreshStakesBtn.addEventListener('click', refreshStakes);
            claimRewardsBtn.addEventListener('click', claimRewards);
            approveTokenBtn.addEventListener('click', approveToken);
            stakeTokenBtn.addEventListener('click', stakeToken);
            unstakeTokenBtn.addEventListener('click', unstakeToken);

            console.log('äº‹ä»¶ç»‘å®šå®Œæˆï¼Œæ£€æµ‹ MetaMask...');
            console.log('window.ethereum å­˜åœ¨å—ï¼Ÿ', !!window.ethereum);
        });

        // è¿æ¥ MetaMask
        async function connectMetaMask() {
            try {
                console.log('ç‚¹å‡»äº†è¿æ¥æŒ‰é’®ï¼Œå¼€å§‹è¿æ¥ MetaMask...');
                
                // æŒ‰é’®çŠ¶æ€æ›´æ–°
                connectBtn.disabled = true;
                connectBtn.textContent = 'è¿æ¥ä¸­...';
                welcomeConnectBtn.disabled = true;
                welcomeConnectBtn.textContent = 'è¿æ¥ä¸­...';
                
                // æ£€æµ‹ MetaMask
                if (!window.ethereum) {
                    throw new Error('æœªæ£€æµ‹åˆ° MetaMaskï¼Œè¯·å…ˆå®‰è£…');
                }

                showStatus('æ­£åœ¨è¿æ¥ MetaMask...', 'info');
                
                // åˆå§‹åŒ–æä¾›è€…
                provider = new ethers.BrowserProvider(window.ethereum);
                console.log('æä¾›è€…åˆå§‹åŒ–å®Œæˆï¼Œè¯·æ±‚è´¦æˆ·æˆæƒ...');
                
                // è¯·æ±‚è´¦æˆ·æˆæƒ
                const accounts = await provider.send('eth_requestAccounts', []);
                currentAccount = accounts[0];
                console.log('æˆæƒæˆåŠŸï¼Œè´¦æˆ·:', currentAccount);
                
                // è·å–ç­¾åè€…
                signer = currentAccount; // ç®€åŒ–ç­¾åè€…é€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨è´¦æˆ·åœ°å€
                console.log('ç­¾åè€…è·å–å®Œæˆ');
                
                // åˆå§‹åŒ–åˆçº¦
                await initializeContracts();
                console.log('åˆçº¦åˆå§‹åŒ–å®Œæˆ');
                
                // æ›´æ–°UI
                updateUIAfterConnection();
                showStatus('è¿æ¥æˆåŠŸï¼', 'success');
                
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                showStatus(`è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                connectBtn.disabled = false;
                connectBtn.textContent = 'è¿æ¥ MetaMask';
                welcomeConnectBtn.disabled = false;
                welcomeConnectBtn.textContent = 'è¿æ¥ MetaMask';
            }
        }

        // åˆå§‹åŒ–åˆçº¦
        async function initializeContracts() {
            contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);
            const memeTokenAddress = await contract.call('memeToken');
            memeTokenContract = new ethers.Contract(memeTokenAddress, [
                {
                    "constant": false,
                    "inputs": [
                        {"name": "_spender", "type": "address"},
                        {"name": "_value", "type": "uint256"}
                    ],
                    "name": "approve",
                    "outputs": [{"name": "", "type": "bool"}],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                }
            ], provider);
        }

        // æ›´æ–°è¿æ¥åçš„UI
        function updateUIAfterConnection() {
            connectBtn.textContent = `å·²è¿æ¥: ${currentAccount.substring(0, 6)}...${currentAccount.substring(38)}`;
            appContent.classList.remove('hidden');
            welcomeContent.classList.add('hidden');
            
            // åŠ è½½åˆå§‹æ•°æ®
            loadPendingRewards();
            refreshStakes();
        }

        // åŠ è½½å¯é¢†å–åˆ†çº¢
        async function loadPendingRewards() {
            try {
                const rewards = await contract.call('getPendingRewards', [currentAccount]);
                pendingRewardsEl.textContent = ethers.utils.formatEther(rewards);
            } catch (error) {
                console.error('è·å–å¯é¢†å–åˆ†çº¢å¤±è´¥:', error);
                pendingRewardsEl.textContent = 'è·å–å¤±è´¥';
            }
        }

        // åˆ·æ–°è´¨æŠ¼åˆ—è¡¨
        async function refreshStakes() {
            try {
                showStatus('æ­£åœ¨åˆ·æ–°è´¨æŠ¼åˆ—è¡¨...', 'info');
                const stakeCount = await contract.call('getUserStakeCount', [currentAccount]);
                
                if (stakeCount.toString() === '0') {
                    stakesListEl.innerHTML = '<div style="text-align: center; color: #666;">æš‚æ— è´¨æŠ¼è®°å½•</div>';
                    showStatus('è´¨æŠ¼åˆ—è¡¨å·²åˆ·æ–°', 'success');
                    return;
                }

                stakesListEl.innerHTML = '';
                const count = parseInt(stakeCount.toString());
                
                for (let i = 0; i < count; i++) {
                    const stakeData = await contract.call('getUserStake', [currentAccount, i]);
                    const [amount, startBlock, unlockBlock] = stakeData;
                    
                    const stakeItem = document.createElement('div');
                    stakeItem.className = 'stake-item';
                    stakeItem.innerHTML = `
                        <div class="stake-info">ç´¢å¼•: ${i}</div>
                        <div class="stake-info">æ•°é‡: ${ethers.utils.formatEther(amount)} MEME</div>
                        <div class="stake-info">å¼€å§‹åŒºå—: ${startBlock.toString()}</div>
                        <div class="stake-info">è§£é”åŒºå—: ${unlockBlock.toString()}</div>
                    `;
                    
                    stakesListEl.appendChild(stakeItem);
                }
                
                showStatus('è´¨æŠ¼åˆ—è¡¨å·²åˆ·æ–°', 'success');
            } catch (error) {
                console.error('åˆ·æ–°è´¨æŠ¼åˆ—è¡¨å¤±è´¥:', error);
                showStatus(`åˆ·æ–°å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¢†å–åˆ†çº¢
        async function claimRewards() {
            try {
                showStatus('æ­£åœ¨é¢†å–åˆ†çº¢...', 'info');
                const tx = await contract.sendTransaction('claimRewards', []);
                showStatus(`äº¤æ˜“å·²å‘é€: ${tx}`, 'success');
                
                // ç­‰å¾…äº¤æ˜“ç¡®è®¤ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…å¯æ ¹æ®éœ€æ±‚ä¼˜åŒ–ï¼‰
                setTimeout(() => {
                    showStatus('åˆ†çº¢é¢†å–æˆåŠŸï¼', 'success');
                    loadPendingRewards();
                }, 5000);
            } catch (error) {
                console.error('é¢†å–åˆ†çº¢å¤±è´¥:', error);
                showStatus(`é¢†å–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æˆæƒä»£å¸
        async function approveToken() {
            try {
                const amount = ethers.utils.parseEther(stakeAmountInput.value || '0');
                if (amount.toString() === '0') {
                    throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„è´¨æŠ¼æ•°é‡');
                }

                showStatus('æ­£åœ¨æˆæƒä»£å¸...', 'info');
                const tx = await memeTokenContract.sendTransaction('approve', [CONTRACT_ADDRESS, amount]);
                showStatus(`æˆæƒäº¤æ˜“å·²å‘é€: ${tx}`, 'success');
                
                setTimeout(() => {
                    showStatus('ä»£å¸æˆæƒæˆåŠŸï¼', 'success');
                }, 5000);
            } catch (error) {
                console.error('æˆæƒä»£å¸å¤±è´¥:', error);
                showStatus(`æˆæƒå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è´¨æŠ¼ä»£å¸
        async function stakeToken() {
            try {
                const amount = ethers.utils.parseEther(stakeAmountInput.value || '0');
                if (amount.toString() === '0') {
                    throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„è´¨æŠ¼æ•°é‡');
                }

                showStatus('æ­£åœ¨è´¨æŠ¼ä»£å¸...', 'info');
                const tx = await contract.sendTransaction('stake', [amount]);
                showStatus(`è´¨æŠ¼äº¤æ˜“å·²å‘é€: ${tx}`, 'success');
                
                setTimeout(() => {
                    showStatus('è´¨æŠ¼æˆåŠŸï¼', 'success');
                    refreshStakes();
                    loadPendingRewards();
                    stakeAmountInput.value = '';
                }, 5000);
            } catch (error) {
                console.error('è´¨æŠ¼ä»£å¸å¤±è´¥:', error);
                showStatus(`è´¨æŠ¼å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å–æ¶ˆè´¨æŠ¼
        async function unstakeToken() {
            try {
                const index = parseInt(unstakeIndexInput.value);
                if (isNaN(index) || index < 0) {
                    throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„è´¨æŠ¼ç´¢å¼•');
                }

                showStatus('æ­£åœ¨å–æ¶ˆè´¨æŠ¼...', 'info');
                const tx = await contract.sendTransaction('unstake', [index]);
                showStatus(`å–æ¶ˆè´¨æŠ¼äº¤æ˜“å·²å‘é€: ${tx}`, 'success');
                
                setTimeout(() => {
                    showStatus('å–æ¶ˆè´¨æŠ¼æˆåŠŸï¼', 'success');
                    refreshStakes();
                    loadPendingRewards();
                    unstakeIndexInput.value = '';
                }, 5000);
            } catch (error) {
                console.error('å–æ¶ˆè´¨æŠ¼å¤±è´¥:', error);
                showStatus(`å–æ¶ˆè´¨æŠ¼å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type) {
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';

            // 3ç§’åè‡ªåŠ¨éšè—æˆåŠŸä¿¡æ¯
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            }
        }
    </script>
</body>
</html>
