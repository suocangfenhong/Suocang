<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”ä»“åˆ†çº¢CTOè‡ªæ²»ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            max-width: 850px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }
        .container {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 20, 60, 0.5), 0 0 16px rgba(6, 182, 212, 0.15);
            border: 1px solid rgba(6, 182, 212, 0.2);
        }
        h1 {
            text-align: center;
            color: #06b6d4;
            font-size: 28px;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(6, 182, 212, 0.3);
            letter-spacing: 1px;
        }
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(6, 182, 212, 0.1);
            transition: all 0.3s ease;
        }
        .section:hover {
            border-color: rgba(6, 182, 212, 0.3);
            box-shadow: 0 4px 16px rgba(6, 182, 212, 0.1);
        }
        .section h2 {
            margin-top: 0;
            color: #38bdf8;
            font-size: 20px;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section h2::before {
            content: "âš™ï¸";
            font-size: 22px;
        }
        input {
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            font-size: 16px;
            background: rgba(15, 23, 42, 0.7);
            color: #e2e8f0;
            transition: all 0.3s ease;
        }
        input:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.2);
        }
        input::placeholder {
            color: #94a3b8;
        }
        button {
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #06b6d4 0%, #38bdf8 100%);
            color: #0f172a;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #0891b2 0%, #2563eb 100%);
            box-shadow: 0 6px 16px rgba(6, 182, 212, 0.4);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn-secondary:hover {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
            transform: translateY(-2px);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%);
            box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);
            transform: translateY(-2px);
        }
        button:disabled {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            color: #cbd5e1;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .status {
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            display: none;
        }
        .success {
            background: rgba(22, 163, 74, 0.2);
            color: #4ade80;
            border: 1px solid rgba(22, 163, 74, 0.3);
        }
        .error {
            background: rgba(220, 38, 38, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        .info {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .network-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid rgba(245, 158, 11, 0.3);
            font-size: 15px;
            text-align: center;
        }
        .info-line {
            margin-bottom: 12px;
            color: #cbd5e1;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(6, 182, 212, 0.1);
        }
        .info-line:last-child {
            border-bottom: none;
        }
        .info-line span:first-child {
            color: #94a3b8;
        }
        .info-line span:last-child {
            color: #38bdf8;
            font-weight: 500;
        }
        .tip-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 14px;
            color: #bfdbfe;
            line-height: 1.6;
        }
        .tip-box strong {
            color: #38bdf8;
        }
        .tg-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-radius: 12px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }
        .tg-section h2 {
            color: #c084fc;
            margin-bottom: 15px;
            font-size: 19px;
            display: inline-block; /* ç¡®ä¿æ ‡é¢˜ä¹Ÿå±…ä¸­ */
        }
        .tg-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            color: white;
            width: auto;
            padding: 12px 30px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            margin: 0 auto; /* å¼ºåˆ¶æŒ‰é’®å±…ä¸­ */
        }
        .tg-btn:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
        }
        .footer {
            text-align: center;
            margin-top: 25px;
            color: #94a3b8;
            font-size: 14px;
            padding: 15px 0;
            border-top: 1px solid rgba(6, 182, 212, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>é”ä»“åˆ†çº¢CTOè‡ªæ²»ç‰ˆ</h1>
        
        <div id="networkWarning" class="network-warning">
            âš ï¸ è­¦å‘Šï¼šå½“å‰ç½‘ç»œä¸æ˜¯ BSC ä¸»ç½‘ï¼ˆChain ID: 56ï¼‰ï¼Œè¯·åˆ‡æ¢åé‡è¯•ï¼
        </div>
        
        <div class="section">
            <h2>é’±åŒ…è¿æ¥</h2>
            <button id="connectBtn" class="btn-primary">ğŸ”Œ è¿æ¥ MetaMask</button>
            <div id="walletAddress" class="info" style="display: none;"></div>
        </div>
        
        <div class="section">
            <h2>è´¦æˆ·ä¿¡æ¯</h2>
            <div id="tokenBalance" class="info-line" style="display: none;">
                <span>é”ä»£å¸ä½™é¢:</span>
                <span id="balanceValue">0</span>
            </div>
            <div id="stakedAmount" class="info-line" style="display: none;">
                <span>å·²é”ä»“æ•°é‡:</span>
                <span id="stakedValue">0</span>
            </div>
            <div id="allowanceAmount" class="info-line" style="display: none;">
                <span>æˆæƒé¢åº¦:</span>
                <span id="allowanceValue">0</span>
            </div>
            <div id="pendingRewards" class="info-line" style="display: none;">
                <span>å¾…é¢†å–åˆ†çº¢:</span>
                <span id="pendingRewardsValue">0</span> BNB
            </div>
        </div>
        
        <div class="section">
            <h2>æˆæƒæ“ä½œ</h2>
            <input type="number" id="approveAmount" placeholder="è¾“å…¥è¦æˆæƒçš„é”ä»£å¸æ•°é‡" min="0" step="0.000000000000000001">
            <button id="approveBtn" class="btn-secondary" disabled>âœ… æˆæƒ</button>
            <div id="approveStatus" class="status"></div>
        </div>
        
        <div class="section">
            <h2>é”ä»“æ“ä½œ</h2>
            <input type="number" id="stakeAmount" placeholder="è¾“å…¥è¦é”ä»“çš„é”ä»£å¸æ•°é‡" min="0" step="0.000000000000000001">
            <button id="stakeBtn" class="btn-primary" disabled>ğŸ”’ é”ä»“</button>
            <div id="stakeStatus" class="status"></div>
        </div>
        
        <div class="section">
            <h2>å–æ¶ˆé”ä»“æ“ä½œ</h2>
            <div class="tip-box">
                <strong>æ“ä½œæç¤ºï¼š</strong><br>
                å‡è®¾ä½ ä¸€å…±é”ä»“äº†3ç¬”ï¼Œé‚£ä¹ˆä½ éœ€è¦åˆ†ä¸‰æ¬¡è§£é”<br>
                è¾“å…¥æ¡†è¾“å…¥å†…å®¹ä¸ºä½ é”ä»“çš„ç¬”æ•°ç´¢å¼•<br>
                ç¬¬ä¸€æ¬¡è¾“å…¥0 â†’ ç¬¬äºŒæ¬¡è¾“å…¥1 â†’ ç¬¬ä¸‰æ¬¡è¾“å…¥2<br>
                ä»¥æ­¤ç±»æ¨
            </div>
            <input type="number" id="unstakeIndex" placeholder="è¾“å…¥è¦å–æ¶ˆé”ä»“çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰" min="0" step="1">
            <button id="unstakeBtn" class="btn-danger" disabled>ğŸ”“ å–æ¶ˆé”ä»“</button>
            <div id="unstakeStatus" class="status"></div>
        </div>
        
        <div class="section">
            <h2>é¢†å–åˆ†çº¢</h2>
            <button id="claimBtn" class="btn-primary" disabled>ğŸ’° é¢†å–åˆ†çº¢</button>
            <div id="claimStatus" class="status"></div>
        </div>
        
        <!-- TGç¾¤å…¥å£ï¼ˆå·²å±…ä¸­ï¼‰ -->
        <div class="tg-section">
            <h2>ğŸ“¢ åŠ å…¥å®˜æ–¹TGç¤¾ç¾¤</h2>
            <a href="https://t.me/suocangfenhong" target="_blank" rel="noopener noreferrer">
                <button class="tg-btn">ğŸ‘‰ ç‚¹å‡»åŠ å…¥TGç¾¤</button>
            </a>
            <p style="margin-top: 10px; color: #94a3b8; font-size: 14px;">è·å–æœ€æ–°èµ„è®¯ã€æ•™ç¨‹å’Œç¤¾åŒºæ”¯æŒ</p>
        </div>
        
        <!-- å¹´ä»½å·²æ”¹ä¸º2026 -->
        <div class="footer">
            é”ä»“åˆ†çº¢CTOè‡ªæ²»ç‰ˆ Â© 2026 | åŸºäºBSCä¸»ç½‘å¼€å‘
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // åˆçº¦åœ°å€
        const TOKEN_CONTRACT_ADDRESS = "0x574f567a3f76b555d0a60bacb1110bf79d2c7777";
        const STAKE_CONTRACT_ADDRESS = "0xCb5c82879A56006d6eEF2d03391E48ff774919A2";
        const BSC_MAINNET_CHAIN_ID = 56; // BSCä¸»ç½‘Chain ID
        
        // åˆçº¦ABIï¼ˆä½¿ç”¨å®Œæ•´ABIï¼‰
        const TOKEN_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)"
        ];
        
        const STAKE_ABI = [{"inputs":[{"internalType":"address","name":"_memeToken","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"EnforcedPause","type":"error"},{"inputs":[],"name":"ExpectedPause","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"DividendDistributed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"admin","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"EmergencyWithdrawBNB","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"admin","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"EmergencyWithdrawMEME","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newBlocks","type":"uint256"}],"name":"LockBlocksUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"oldToken","type":"address"},{"indexed":false,"internalType":"address","name":"newToken","type":"address"}],"name":"MemeTokenUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newAmount","type":"uint256"}],"name":"MinLockAmountUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RewardClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Staked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"penalty","type":"uint256"}],"name":"Unstaked","type":"event"},{"inputs":[],"name":"BURN_ADDRESS","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DISTRIBUTION_THRESHOLD","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PENALTY_RATE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"disableStaking","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"dividendPerToken","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"emergencyWithdrawBNB","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"emergencyWithdrawMEME","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"enableStaking","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getPendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getUserStake","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"startBlock","type":"uint256"},{"internalType":"uint256","name":"unlockBlock","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserStakeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lockBlocks","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"memeToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minLockAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pendingBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_blocks","type":"uint256"}],"name":"setLockBlocks","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newMemeToken","type":"address"}],"name":"setMemeToken","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"setMinLockAmount","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"stake","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"unstake","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userStakes","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"startBlock","type":"uint256"},{"internalType":"uint256","name":"dividendPerTokenAtStake","type":"uint256"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];
        
        // å…¨å±€å˜é‡
        let provider, signer, address;
        let tokenContract, stakeContract;
        let currentChainId = null;
        
        // DOMå…ƒç´ 
        const connectBtn = document.getElementById("connectBtn");
        const walletAddress = document.getElementById("walletAddress");
        const networkWarning = document.getElementById("networkWarning");
        const tokenBalance = document.getElementById("tokenBalance");
        const balanceValue = document.getElementById("balanceValue");
        const stakedAmount = document.getElementById("stakedAmount");
        const stakedValue = document.getElementById("stakedValue");
        const allowanceAmount = document.getElementById("allowanceAmount");
        const allowanceValue = document.getElementById("allowanceValue");
        const pendingRewards = document.getElementById("pendingRewards");
        const pendingRewardsValue = document.getElementById("pendingRewardsValue");
        const approveAmount = document.getElementById("approveAmount");
        const approveBtn = document.getElementById("approveBtn");
        const approveStatus = document.getElementById("approveStatus");
        const stakeAmount = document.getElementById("stakeAmount");
        const stakeBtn = document.getElementById("stakeBtn");
        const stakeStatus = document.getElementById("stakeStatus");
        const unstakeIndex = document.getElementById("unstakeIndex");
        const unstakeBtn = document.getElementById("unstakeBtn");
        const unstakeStatus = document.getElementById("unstakeStatus");
        const claimBtn = document.getElementById("claimBtn");
        const claimStatus = document.getElementById("claimStatus");
        
        // ç›‘å¬ç½‘ç»œå˜åŒ–
        if (window.ethereum) {
            window.ethereum.on('chainChanged', (chainId) => {
                currentChainId = parseInt(chainId, 16);
                checkNetwork();
                if (address) updateAccountInfo();
            });
        }
        
        // æ£€æŸ¥ç½‘ç»œ
        function checkNetwork() {
            const isBSCMainnet = currentChainId === BSC_MAINNET_CHAIN_ID;
            networkWarning.style.display = isBSCMainnet ? "none" : "block";
            return isBSCMainnet;
        }
        
        // è¿æ¥é’±åŒ…
        connectBtn.addEventListener("click", async () => {
            if (window.ethereum) {
                try {
                    // è¯·æ±‚ç”¨æˆ·æˆæƒ
                    await window.ethereum.request({ method: "eth_requestAccounts" });
                    
                    // è·å–å½“å‰ç½‘ç»œ
                    currentChainId = parseInt(await window.ethereum.request({ method: "eth_chainId" }), 16);
                    
                    // æ£€æŸ¥ç½‘ç»œ
                    if (!checkNetwork()) {
                        showStatus(approveStatus, "è¯·åˆ‡æ¢åˆ° BSC ä¸»ç½‘ï¼ˆChain ID: 56ï¼‰", "error");
                        return;
                    }
                    
                    // åˆ›å»ºproviderå’Œsigner
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    address = await signer.getAddress();
                    
                    // æ˜¾ç¤ºé’±åŒ…åœ°å€
                    walletAddress.textContent = `å·²è¿æ¥: ${address.substring(0,6)}...${address.substring(38)}`;
                    walletAddress.style.display = "block";
                    
                    // åˆå§‹åŒ–åˆçº¦
                    tokenContract = new ethers.Contract(TOKEN_CONTRACT_ADDRESS, TOKEN_ABI, signer);
                    stakeContract = new ethers.Contract(STAKE_CONTRACT_ADDRESS, STAKE_ABI, signer);
                    
                    // æ›´æ–°è´¦æˆ·ä¿¡æ¯
                    updateAccountInfo();
                    
                    // å¯ç”¨æŒ‰é’®
                    approveBtn.disabled = false;
                    stakeBtn.disabled = false;
                    unstakeBtn.disabled = false;
                    claimBtn.disabled = false;
                    
                    // ç¦ç”¨è¿æ¥æŒ‰é’®
                    connectBtn.disabled = true;
                    connectBtn.innerHTML = "âœ… å·²è¿æ¥";
                } catch (error) {
                    showStatus(approveStatus, "è¿æ¥é’±åŒ…å¤±è´¥: " + error.message, "error");
                }
            } else {
                showStatus(approveStatus, "è¯·å®‰è£… MetaMask é’±åŒ…", "error");
            }
        });
        
        // æ›´æ–°è´¦æˆ·ä¿¡æ¯
        async function updateAccountInfo() {
            try {
                // æ£€æŸ¥ç½‘ç»œ
                if (!checkNetwork()) return;
                
                // è·å–ä»£å¸ä½™é¢
                const balance = await tokenContract.balanceOf(address);
                balanceValue.textContent = ethers.utils.formatEther(balance);
                tokenBalance.style.display = "flex";
                
                // è·å–æˆæƒé¢åº¦
                const allowance = await tokenContract.allowance(address, STAKE_CONTRACT_ADDRESS);
                allowanceValue.textContent = ethers.utils.formatEther(allowance);
                allowanceAmount.style.display = "flex";
                
                // è·å–å¾…é¢†å–åˆ†çº¢
                const rewards = await stakeContract.getPendingRewards(address);
                pendingRewardsValue.textContent = ethers.utils.formatEther(rewards);
                pendingRewards.style.display = "flex";
                
                // è®¡ç®—å·²é”ä»“æ€»æ•°
                const stakeCount = await stakeContract.getUserStakeCount(address);
                let totalStaked = ethers.BigNumber.from(0);
                
                for (let i = 0; i < stakeCount.toNumber(); i++) {
                    const stake = await stakeContract.getUserStake(address, i);
                    totalStaked = totalStaked.add(stake.amount);
                }
                
                stakedValue.textContent = ethers.utils.formatEther(totalStaked);
                stakedAmount.style.display = "flex";
            } catch (error) {
                showStatus(approveStatus, "è·å–è´¦æˆ·ä¿¡æ¯å¤±è´¥: " + error.message, "error");
            }
        }
        
        // æˆæƒæ“ä½œ
        approveBtn.addEventListener("click", async () => {
            const amount = approveAmount.value;
            if (!amount || amount <= 0) {
                showStatus(approveStatus, "è¯·è¾“å…¥æœ‰æ•ˆçš„æˆæƒæ•°é‡", "error");
                return;
            }
            
            try {
                showStatus(approveStatus, "æ­£åœ¨æˆæƒ...", "info");
                
                // è½¬æ¢ä¸ºwei
                const amountWei = ethers.utils.parseEther(amount);
                
                // è°ƒç”¨approveå‡½æ•°
                const tx = await tokenContract.approve(STAKE_CONTRACT_ADDRESS, amountWei, {
                    gasLimit: 100000
                });
                
                // ç­‰å¾…äº¤æ˜“ç¡®è®¤
                await tx.wait();
                
                showStatus(approveStatus, `æˆæƒæˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, "success");
                
                // æ›´æ–°è´¦æˆ·ä¿¡æ¯
                updateAccountInfo();
            } catch (error) {
                showStatus(approveStatus, "æˆæƒå¤±è´¥: " + error.message, "error");
            }
        });
        
        // é”ä»“æ“ä½œ
        stakeBtn.addEventListener("click", async () => {
            const amount = stakeAmount.value;
            if (!amount || amount <= 0) {
                showStatus(stakeStatus, "è¯·è¾“å…¥æœ‰æ•ˆçš„é”ä»“æ•°é‡", "error");
                return;
            }
            
            try {
                showStatus(stakeStatus, "æ­£åœ¨é”ä»“...", "info");
                
                // è½¬æ¢ä¸ºwei
                const amountWei = ethers.utils.parseEther(amount);
                
                // è°ƒç”¨stakeå‡½æ•°
                const tx = await stakeContract.stake(amountWei, {
                    gasLimit: 200000
                });
                
                // ç­‰å¾…äº¤æ˜“ç¡®è®¤
                await tx.wait();
                
                showStatus(stakeStatus, `é”ä»“æˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, "success");
                
                // æ›´æ–°è´¦æˆ·ä¿¡æ¯
                updateAccountInfo();
            } catch (error) {
                showStatus(stakeStatus, "é”ä»“å¤±è´¥: " + error.message, "error");
            }
        });
        
        // å–æ¶ˆé”ä»“æ“ä½œ
        unstakeBtn.addEventListener("click", async () => {
            const index = unstakeIndex.value;
            if (!index || index < 0) {
                showStatus(unstakeStatus, "è¯·è¾“å…¥æœ‰æ•ˆçš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰", "error");
                return;
            }
            
            try {
                showStatus(unstakeStatus, "æ­£åœ¨å–æ¶ˆé”ä»“...", "info");
                
                // è°ƒç”¨unstakeå‡½æ•°
                const tx = await stakeContract.unstake(index, {
                    gasLimit: 200000
                });
                
                // ç­‰å¾…äº¤æ˜“ç¡®è®¤
                await tx.wait();
                
                showStatus(unstakeStatus, `å–æ¶ˆé”ä»“æˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, "success");
                
                // æ›´æ–°è´¦æˆ·ä¿¡æ¯
                updateAccountInfo();
            } catch (error) {
                showStatus(unstakeStatus, "å–æ¶ˆé”ä»“å¤±è´¥: " + error.message, "error");
            }
        });
        
        // é¢†å–åˆ†çº¢æ“ä½œ
        claimBtn.addEventListener("click", async () => {
            try {
                showStatus(claimStatus, "æ­£åœ¨é¢†å–åˆ†çº¢...", "info");
                
                // è°ƒç”¨claimRewardså‡½æ•°
                const tx = await stakeContract.claimRewards({
                    gasLimit: 200000
                });
                
                // ç­‰å¾…äº¤æ˜“ç¡®è®¤
                await tx.wait();
                
                showStatus(claimStatus, `é¢†å–åˆ†çº¢æˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, "success");
                
                // æ›´æ–°è´¦æˆ·ä¿¡æ¯
                updateAccountInfo();
            } catch (error) {
                showStatus(claimStatus, "é¢†å–åˆ†çº¢å¤±è´¥: " + error.message, "error");
            }
        });
        
        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(element, message, type) {
            element.textContent = message;
            element.className = "status " + type;
            element.style.display = "block";
            
            // 5ç§’åè‡ªåŠ¨éšè—æˆåŠŸå’Œä¿¡æ¯çŠ¶æ€
            if (type === "success" || type === "info") {
                setTimeout(() => {
                    element.style.display = "none";
                }, 5000);
            }
        }
    </script>
</body>
</html>
